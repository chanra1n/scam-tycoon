<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>Scam Center Tycoon</title>
  <!-- UIkit CSS -->
  <link rel="stylesheet" href="css/lib/uikit.css" />

  <script src="js/lib/chart.js"></script>
  <!-- UIkit JS -->
  <script src="js/lib/uikit.js"></script>
  <script src="js/lib/uikit-icons.js"></script>
  <link rel="stylesheet" href="css/lib/remixicon.css" />
  <link rel="stylesheet" href="css/custom/crt.css">
  <link rel="stylesheet" href="css/custom/vig.css">
  <link rel="stylesheet" href="css/custom/filters.css">
  <link rel="stylesheet" href="css/custom/lines.css">
  <script src='js/lib/panzoom.js'></script>
  <script src="js/lib/popper.js"></script>
  <script src="js/lib/tippy.js"></script>
  <script src="js/lib/jquery.js"></script>
  <script src="js/lib/jquery-ui.js"></script>
  <style>
    /*add my custom fonts*/

    @font-face {
      font-family: "gamer";
      src: url("fonts/gamer.ttf");
    }

    @font-face {
      font-family: "beeg";
      src: url("fonts/8bitfont.ttf");
    }

    @font-face {
      font-family: "pst";
      src: url("fonts/pst.ttf");
    }

    body,
    html {
      margin: 0;
      padding: 0px;
      width: 100vh;
      font-family: 'gamer';
      filter: sepia(1) hue-rotate(45deg);
      user-select: none !important;
      background-color: black;
      width: 100vh;
      overflow: hidden;
      background-image: url("sprites/street.gif");
    background-position: center;
    background-repeat: no-repeat;
    background-size: cover;
    }

    body {
      transform: translate(-50%, -50%);
      position: absolute;
      top: 50%;
      left: 50%;
    }

    .grid-container {
      display: grid;
      grid-template-columns: repeat(48, 1fr);
      grid-template-rows: repeat(48, 1fr);
      background-color: #ccc;
      width: 100%;
      height: 100%;
      position: relative;
      margin: 0px;
      transition: all 0.25s linear;
      background-color: #a1a1a1 !important;
    }

    .grid-item {
      background-color: #e9e9e9;
      outline: 1.5px solid #c3c3c320;
      box-sizing: border-box;
      background-image: url('sprites/city_block.png');
      background-size: 100%;
      background-repeat: no-repeat;
      image-rendering: optimizeSpeed;
      transition: opacity 0.25s linear;
      background-color: #a1a1a1 !important;

    }

    button {
      cursor: pointer;
    }

    #player {
      width: 32px;
      height: 32px;
      position: absolute;
      top: 50%;
      left: 50%;
      z-index: 100000;
      opacity: 0%;
      background-color: transparent;
      transform: scale(0.5);
      transition: top 0.25s, left 0.25s, opacity 0.1s, transform 0.25s;
      background-size: 100%;
      filter: invert(1) brightness(75%) grayscale(1) contrast(250%) drop-shadow(0px 0px 15px #1a1a1a);
      background-image: url('sprites/character/cat/black/front/front2.png');
    }

    #world-map {
      transition: all 0.25s linear, filter 5s auto;
      width: 100vh;
      height: 100vh;
    }

    #fps {
      position: absolute;
      bottom: 0;
      right: 0;
      color: #a1a1a1;
      background-color: black;
      z-index: 100;
      margin: 7.5px;
      width: 10vh;
      text-align: center;
      box-shadow: 4px 4px 0px green;
      font-size: 8px;
      padding: 5px;
      white-space: nowrap;
      font-family: 'pst';
    }

    .police-car {
      position: absolute;
      top: 0;
      left: 0;
      background-color: black;
      width: 8px;
      height: 8px;
    }

    #help-dropdown {
      padding: 15px !important;
    }

    .guide_container {
      background-color: green;
      color: black;
      font-family: 'pst';
      border: none;
      padding: 7.5px;
      font-size: 8px;
      display: block;
      margin: 10px;
      width: 100%;
      box-sizing: border-box;
      margin-left: 0px;
      margin-right: 0px;
      line-break: normal;
      vertical-align: middle;
    }

    .guide_container i {
      float: left;
      vertical-align: middle;
      transform: scale(1.1);
    }
  </style>
  <link rel="stylesheet" href="css/custom/menuBarDropdownItemStyles.css">
  <link rel="stylesheet" href="css/custom/menuItemStyles.css">
  <link rel="stylesheet" href="css/custom/sideBarMenuItems.css">
  <link rel="stylesheet" href="css/custom/uikitMods.css">
  <link rel="stylesheet" href="css/custom/menuBarStyles.css">
  <link rel="stylesheet" href="css/custom/tippyConfig.css">
  <link rel="stylesheet" href="css/custom/taxformStyles.css">
  <link rel="stylesheet" href="css/custom/mailStyles.css">
  <link rel="stylesheet" href="css/custom/weather.css">
  <link rel="stylesheet" href="css/custom/battleStyles.css">
  <link rel="stylesheet" href="css/custom/zones.css">
  <link rel="stylesheet" href="css/custom/buildings.css">
</head>

<body>
  <span id="fps"></span>
  <div id="crt-lines" style="opacity:10%"></div>
  <div id="vignette" style="opacity:40%"></div>
  <div id="weather_filter" class="weather_filter back-row-toggle splat-toggle">
    <div class="rain front-row"></div>
    <div class="rain back-row"></div>
  </div>
  <div id="fog_filter"></div>
  <div id="player"></div>

  <div id="sidebar">
    <i id="help-icon" class="sidebar-icon ri-questionnaire-fill"></i>
    <div id="help-dropdown" uk-dropdown>
      <h1 class="selectascam">NEED SOME HELP?</h1>
      <hr class="selectascamhr">
      <button class="guide_container"><i class="ri-building-4-fill"></i> BUILDING BASICS</button>
      <button class="guide_container"><i class="ri-money-dollar-circle-fill"></i> EXPENSES GUIDE</button>
      <button class="guide_container"><i class="ri-bank-card-fill"></i> INTRO TO CREDIT</button>
      <button class="guide_container"><i class="ri-star-smile-fill"></i> HIRING INFO</button>
      <button class="guide_container"><i class="ri-database-2-fill"></i> CURRENCY TYPES</button>
      <button class="guide_container"><i class="ri-hand-coin-fill"></i> SCAM TYPES</button>
    </div>

    <i id="radio-icon" class="sidebar-icon ri-radio-fill"></i>
    <div id="radio-dropdown" uk-dropdown>
      <iframe src="https://lofi.cafe"></iframe>
      <a id="radio-link" href="https://lofi.cafe" target="_blank">lofi.cafe</a>
    </div>

    <i id="mail-icon" class="sidebar-icon ri-mail-fill"></i>

    <div id="mail-dropdown" onmouseenter="document.getElementById('mail-icon').style.animation = 'none'" uk-dropdown>
      <span style="
      font-size: 18px;
      margin: 0px;
      padding: 0px;
      ">YOUR INBOX</span>
      <button id="dismissbutton" onclick="document.getElementById('inbox').innerHTML ='';notifCounter=0">DISMISS
        ALL</button>
      <hr class="selectascamhr">
      <span class="datapointspan" id="mail_blurb" style="font-family:'pst'">IMPORTANT MESSAGES SHOW UP HERE, SO BE SURE
        TO CHECK BACK!</span>
      <div id="inbox"></div>
    </div>

  </div>

  <div id="user-desk">
    <!--let's make a mock tax form-->
    <div id="tax-form">
      <h1 style="font-family:'gamer';font-size:20px;">FORM C 8008-135</h1>
      <hr>
      <h2 style="font-family:'pst';font-size:12px;">TAX FORM</h2>
      <hr>
      <p>Enter the total number of employed individuals at your company for the current reporting period.</p>
      <hr class="smallhr">
      <input type="number" id="worker-tax-count" />

      <p>Specify the current balance of monetary funds held in the savings account(s) of your corporate entity.</p>
      <hr class="smallhr">
      <input type="number" id="savings-tax-count" />

      <p>Disclose the monetary valuation of any additional savings accounts held by your corporate entity.</p>
      <hr class="smallhr">
      <input type="number" id="otherSavings-tax-count" />

      <p>List the number of operational premises affiliated with your corporate entity.</p>
      <hr class="smallhr">
      <input type="number" id="location-tax-count" />


      <button id="submit-tax-form" onclick="submitTaxForm()">SUBMIT</button>


    </div>
  </div>

  <div id="topbar">

    <div style="float:left;position:absolute;overflow:hidden;height:100%;">

      <div style="display:none">
        <select id="building-select">
          <option value="admin-buildings">Call Center</option>
          <option value="office-building">Office Building</option>
          <!-- Add more options as needed -->
        </select>
        <button id="toggle-building-mode"><i class="ri-hammer-fill"></i></button>
      </div>

      <div id="calendar_widget">
        <p id="calendar_month">JAN</p>
        <p id="calendar_day">01</p>
      </div>

    </div>
    <div class="right" style="float:right;display:flex;">

      <p id="player-money"> <i class="ri-money-dollar-circle-fill"></i> 0</p>

      <div id="credit-line-list" uk-dropdown>

        <ul class="uk-nav uk-dropdown-nav"><span style="font-size:17.5px">CURRENT MONTHLY READOUT</span>
          <hr class="selectascamhr">
          <span id="current_daily_income_display">+ $0.00/day</span>
          <span id="current_monthly_income_display">$0/mo.</span>
          <canvas id="income_chart"></canvas>
          <span id="current_monthly_expenses_display"><i class="ri-money-dollar-circle-line"></i> </span>
        </ul>
        <br>
        <h1 style="    font-family: 'gamer';
        font-size: 15px;
        margin: 0px;
        padding: 0px;
        margin-bottom: 2.5px;">CREDIT REMAINING FOR THIS MONTH</h1>
        <hr>
        <h2 class="bigcreditnumber" id="spending_limit">$0.00</h2>

        <div id="credit-input-dialog">
          <p>HOW MUCH WOULD YOU LIKE TO CASH OUT?</p>
          <input type="number" id="cashout-amount" />
          <button id="cashout-button" onclick="creditCashOut(document.getElementById('cashout-amount').value)">CASH
            OUT</button>
        </div>

        <button class="cashoutbutton" id="cashoutcreditbutton" onclick="$('#credit-input-dialog').dialog('open');">CASH
          OUT</button>
        <br>
        <h1 style="    font-family: 'gamer';
        font-size: 16px;
        margin: 0px;
        padding: 0px;
        margin-bottom: 2.5px;">AMOUNT SPENT + INTEREST RATE</h1>
        <hr>

        <h2 class="bigcreditnumber" id="amount_to_pay">$0.00</h2><span style="opacity:75%;font-size:17.5px;"> +</span>
        <h2 style="opacity:75%;font-size:27.5px" class="bigcreditnumber" id="current_interest">0%</h2>
        <span style="opacity:75%;font-size:17.5px;"> =</span>

        <br>

        <h2 class="bigcreditnumber" id="total_to_pay">$0.00</h2>

        <button class="cashoutbutton" id="payoffbutton" onclick="payOffDebt()"> PAY OFF DEBT</button>
        <br>
        <ul class="uk-nav uk-dropdown-nav"><span style="font-size:17.5px">AVAILABLE LINES OF CREDIT</span>
          <hr class="selectascamhr">
          <span class="datapointspan" id="credit_blurb" style="font-family:'pst'">DOWN ON YOUR LUCK? GET MONEY FAST,
            OPEN A LINE OF CREDIT! WHAT COULD GO WRONG?</span>
          <div id="credit-line-index-list">

            <div class="credit_line_listing_item">
              <span>L0AN$HARKZ.COM</span>
              <h3>Hey kid, need CA$H fast?</h3>
              <h4><i class="ri-skip-up-fill"></i> $5M/mo.</h4>
              <h4> <i style="font-size:12px" class="ri-discount-percent-fill"></i> 25%</h4>
              <button onclick="selectCreditLine(bank1, this)">OPEN ACCOUNT</button>
            </div>

            <div class="credit_line_listing_item">
              <span>DANK OF ABEARICA</span>
              <h3>Infinite growth. No excuses.</h3>
              <h4><i class="ri-skip-up-fill"></i> $1M/mo.</h4>
              <h4> <i style="font-size:12px" class="ri-discount-percent-fill"></i> 10%</h4>
              <button onclick="selectCreditLine(bank2, this)">OPEN ACCOUNT</button>
            </div>

            <div class="credit_line_listing_item">
              <span>WASTERCURD</span>
              <h3>For everything money can buy.</h3>
              <h4><i class="ri-skip-up-fill"></i> $500K/mo.</h4>
              <h4> <i style="font-size:12px" class="ri-discount-percent-fill"></i> 7%</h4>
              <button onclick="selectCreditLine(bank3, this)">OPEN ACCOUNT</button>
            </div>


            <div class="credit_line_listing_item">
              <span>MEESA INC.</span>
              <h3>Everywhere you are.</h3>
              <h4><i class="ri-skip-up-fill"></i> $100K/mo.</h4>
              <h4> <i style="font-size:12px" class="ri-discount-percent-fill"></i> 5%</h4>
              <button onclick="selectCreditLine(bank4, this)">OPEN ACCOUNT</button>
            </div>

          </div>
        </ul>
      </div>


      <p id="player-datapoints" style="outline-color:white;"><i class="ri-database-2-fill"></i> 0</p>

      <div id="datapoint-trade-list"
        onmouseenter="document.getElementById('player-datapoints').style.animation = 'none';" uk-dropdown>
        <ul class="uk-nav uk-dropdown-nav"><span style="font-size:17.5px">AVAILABLE DATACHUNK TRADES</span>
          <hr class="selectascamhr">
          <span class="datapointspan" id="datachunk_blurb" style="font-family:'pst'">DATACHUNKS ARE OBTAINED THROUGH
            TECH SUPPORT OR IDENTITY THEFT SCAMS. THEY CAN BE USED FOR TRADE WITH INTERESTED PARTIES TO EARN HIGHER
            PAYOUTS.</span>
        </ul>
      </div>


      <p id="employee-count"><i class="ri-user-5-fill"></i> 0</p>

      <div id="employee-index-list" uk-dropdown>
        <ul class="uk-nav uk-dropdown-nav"><span style="font-size:17.5px">YOUR WORKER READOUT</span>
          <hr class="selectascamhr">
          <span class="datapointspan" id="employee_blurb" style="font-family:'pst'">WORKERS HELP YOU EARN MONEY MORE
            FREQUENTLY. THEIR EFFECTIVENESS INCREASES WITH PAY!</span>
        </ul>

        <div id="employee_index_div">

          <span>PRODUCTIVITY BONUS</span>

          <canvas id="employee_productivity_chart"></canvas>

          <hr style="margin-top:7.5px">

          <h2 id="current_employee_count">EMPLOYEES: <span>0</span></h2>
          <h2 id="current_intern_count">INTERNS: <span>0</span></h2>
          <h2 id="current_lawyer_count">LAWYERS: <span>0</span></h2>

        </div>

        <br>
        <span style="display:inline-block;font-size:16px;">HIRE EXTRA EMPLOYEES</span>
        <span class="datapointspan wages" style="font-family:'pst';font-size:6.5px">$3.0K/mo.</span>
        <hr class="selectascamhr">
        <button class="hire" id="hire_10_employees_button" onclick="hireExtraWorkers('employee', 10)">+10</button>
        <button class="hire" id="hire_50_employees_button" onclick="hireExtraWorkers('employee', 50)">+50</button>
        <button class="hire" id="hire_100_employees_button" onclick="hireExtraWorkers('employee', 100)">+100</button>
        <br>
        <button class="fire" id="fire_10_employees_button" onclick="fireExtraWorkers('employee', 10)">-10</button>
        <button class="fire" id="fire_50_employees_button" onclick="fireExtraWorkers('employee', 50)">-50</button>
        <button class="fire" id="fire_100_employees_button" onclick="fireExtraWorkers('employee', 100)">-100</button>

        <br>

        <span style="display:inline-block;font-size:16px;">HIRE INTERNS</span>
        <span class="datapointspan wages" style="font-family:'pst';font-size:6.5px">$1.0K/mo.</span>
        <hr class="selectascamhr">
        <button class="hire" id="hire_10_interns_button" onclick="hireExtraWorkers('intern', 10)">+10</button>
        <button class="hire" id="hire_50_interns_button" onclick="hireExtraWorkers('intern', 50)">+50</button>
        <button class="hire" id="hire_100_interns_button" onclick="hireExtraWorkers('intern', 100)">+100</button>
        <br>
        <button class="fire" id="fire_10_interns_button" onclick="fireExtraWorkers('intern', 10)">-10</button>
        <button class="fire" id="fire_50_interns_button" onclick="fireExtraWorkers('intern', 50)">-50</button>
        <button class="fire" id="fire_100_interns_button" onclick="fireExtraWorkers('intern', 100)">-100</button>
        <br>

        <span style="display:inline-block;font-size:16px;">HIRE LAWYERS</span>
        <span class="datapointspan wages" style="font-family:'pst';font-size:6.5px">$7.5K/mo.</span>
        <hr class="selectascamhr">
        <button class="hire" id="hire_10_lawyers_button" onclick="hireExtraWorkers('lawyer', 10)">+10</button>
        <button class="hire" id="hire_50_lawyers_button" onclick="hireExtraWorkers('lawyer', 50)">+50</button>
        <button class="hire" id="hire_100_lawyers_button" onclick="hireExtraWorkers('lawyer', 100)">+100</button>
        <br>
        <button class="fire" id="fire_10_lawyers_button" onclick="fireExtraWorkers('lawyer', 10)">-10</button>
        <button class="fire" id="fire_50_lawyers_button" onclick="fireExtraWorkers('lawyer', 50)">-50</button>
        <button class="fire" id="fire_100_lawyers_button" onclick="fireExtraWorkers('lawyer', 100)">-100</button>

      </div>


      <p id="building-count"><i class="ri-hotel-fill"></i> 0</p>

      <div id="building-index-list" uk-dropdown>
        <ul class="uk-nav uk-dropdown-nav"><span style="font-size:17.5px">CURRENT PROPERTY INDEX</span>
          <hr class="selectascamhr">
          <span class="datapointspan" id="property_blurb" style="font-family:'pst'">PROPERTIES GENERATE INCOME FOR YOUR
            BUSINESS, BUT INCUR EXPENSES LIKE RENT OR UTILITIES.</span>
        </ul>
      </div>
    </div>

  </div>




  <div id="battleFrame">

    <div id="light">
      <div id="lineh1"></div>
      <div id="lineh2"></div>
      <div id="lineh3"></div>
      <div id="lineh4"></div>
      <div id="lineh5"></div>
      <div id="lineh6"></div>
      <div id="lineh7"></div>
      <div id="lineh8"></div>
      <div id="lineh9"></div>
      <div id="lineh10"></div>
      <div id="lineh11"></div>
      <div id="lineh12"></div>
      <div id="lineh13"></div>
      <div id="lineh14"></div>
      <div id="lineh15"></div>
    </div>

    <div id="enemy_battle_sprite" src="sprites/officer_approaches.png"></div>

    <div id="battleTextDiv">

      <div id="battleText">

        <p id="battleTextContent">A wild POLICE OFFICER appeared! Time to review your legal options...</p>
      </div>

      <div id="playerOptionsMenu">

        <button id="playerAttackButton" onclick="playerAttack()"><i class="ri-auction-fill"></i> OBJECT</button>
        <button id="playerFleeButton" onclick="endBattleEvent()"><i class="ri-run-fill"></i> RUN</button>

      </div>

    </div>

  </div>

  <div id="world-map" class="grid-container"></div>

  <script src="js/custom/functionLibrary.js"></script>
  <script src="js/custom/layoutGen.js"></script>
  <script src="js/custom/panZoomConfig.js"></script>
  <script src="js/custom/chartjsConfig.js"></script>

  <script src="js/custom/buildingMode.js"></script>
  <script src="js/custom/buildingAppearance.js"></script>
  <script src="js/custom/buildingGen.js"></script>
  <script src="js/custom/buildingFunctions.js"></script>

  <script src="js/custom/updateFunctions.js"></script>
  <script src="js/custom/tippyConfig.js"></script>
  <script src="js/custom/scams.js"></script>
  <script src="js/custom/intervals.js"></script>
  <script src="js/custom/datachunkInfo.js"></script>
  <script src="js/custom/creditFunctions.js"></script>
  <script src="js/custom/workerFunctions.js"></script>
  <script src="js/custom/initFunctions.js"></script>

  <script src="js/lib/three.js"></script>
  <script src="js/lib/vanta_fog.js"></script>
  <script src="js/lib/vanta_cells.js"></script>
  <script src="js/lib/vanta_clouds.js"></script>
  <script src="js/lib/vanta_waves.js"></script>
  <script src="js/lib/vanta_birds.js"></script>
  <script src="js/custom/rainWeather.js"></script>
  <script src="js/custom/weatherFunctions.js"></script>

  <script src="js/lib/pathfinding.js"></script>

  <script>

    var panZoomModeEnabled = true;

    var playerDecidedPay = 100;

    var unlockable_options = `
    <option value="identity_theft">IDENTITY THEFT</option>
        <option value="credit_card">CNP FRAUD</option>
        <option value="tech_support">TECH SUPPORT</option>
        `;

    var player = {
      money: 0,
      income: 0,
      expenses: 0,
      level: 0,
      employees: 0,
      buildings: 0,
      buildingsIndex: [],
      persuasiveness: 0,
      datapoints: 0,
      modifierRate: 0,
      interns: 0,
      lawyers: 0,
      spendingLimit: 0,
      creditScore: 600,
      interestRate: 0,
      selectedBanks: [],
      reportingAccuracy: {
        onWorkers: 0,
        onSavings: 0,
        onOtherSavings: 0,
        onLocations: 0,
      },
      payrollTaxFraudCounts: 0,
      accountingFraudCounts: 0,
      nonDisclosureFraudCounts: 0,
      propertyTaxFraudCounts: 0,
      dataTraffickingCounts: 0,
    };

    var police = {
      aggression: 1,
      awareness: 1,
    }

    var payrollTaxFraudCommittedThisYear = 0;
    var accountingFraudCommittedThisYear = 0;
    var nonDisclosureFraudCommittedThisYear = 0;
    var propertyTaxFraudCommittedThisYear = 0;



    window.onload = function () {
      initTime();
      movePlayer();
      initBuildingAppearance();
      //updateBalance("add", 500000);
      sendMail('Welcome to SCAM CENTER TYCOON!', `Be sure to read the game manual if you haven't already.`);
      sendMail('NOTICE OF REGISTRATION', `This notice is to inform you that your business has officially been registered.
    Please ensure that your business maintains compliance with all local laws and regulations.`);

      sendMail('SUSPICIOUS ANGEL INVESTOR', `Make it count.`, `
    <button onclick="updateBalance('add', 500000);removeMail(this.parentElement)"><i style = "float:none!important;font-size:12px!important;" class="ri-money-dollar-circle-fill"></i> ACCEPT [$500K]</button>
    `);
      updateBalance("add", 0);
      //updateBalance("add", 10000000000000);
      initToolbars();
      initIntervals();
      $("#credit-input-dialog").dialog({
        autoOpen: false,
      }
      );
      notifyPlayer('Welcome to SCAM CENTER TYCOON!');
      //beginBattleEvent();
    };

    var secondlyRate = 2500;

    var dailyInterval = setInterval(dailyUpdate, dailyMillisecondValue);

    var monthlyInterval = setInterval(monthlyUpdate, monthlyMillisecondValue);

    var secondlyInterval = setInterval(secondlyUpdate, secondlyRate);


    function generatePercentage(average) {
      // take an input, like 0.1 (10%) and generate a random number between 0.1 and 0.2 (10% and 20%)
      var random = Math.random();
      var percentage = average + (random * average);
      console.log(percentage);
      return percentage;
    }


    function beginTaxEvent() {
      killTime();

      payrollTaxFraudCommittedThisYear = 0;
      accountingFraudCommittedThisYear = 0;
      nonDisclosureFraudCommittedThisYear = 0;
      propertyTaxFraudCommittedThisYear = 0;

      document.getElementById('worker-tax-count').placeholder = player.employees + player.interns + player.lawyers;
      document.getElementById('savings-tax-count').placeholder = player.money;
      document.getElementById('otherSavings-tax-count').placeholder = player.datapoints;
      document.getElementById('location-tax-count').placeholder = player.buildings;

      document.getElementById('world-map').style.filter = "blur(10px)";
      document.getElementById('user-desk').style.bottom = "-15%";
      document.getElementById('user-desk').style.pointerEvents = "auto";
      document.getElementById('sidebar').style.display = "none";
    }


    function submitTaxForm() {



      // basically, take the values that the player entered, and compare them to their "true" values.
      // record how off they were from the true value, and add it to their reportingAccuracy object.

      var workerTaxCount = parseInt(document.getElementById('worker-tax-count').value);
      var savingsTaxCount = parseInt(document.getElementById('savings-tax-count').value);
      var otherSavingsTaxCount = parseInt(document.getElementById('otherSavings-tax-count').value);
      var locationTaxCount = parseInt(document.getElementById('location-tax-count').value);

      if (workerTaxCount == 0 || isNaN(workerTaxCount)) {
        workerTaxCount = player.employees + player.interns + player.lawyers;
      }

      if (savingsTaxCount == 0 || isNaN(savingsTaxCount)) {
        savingsTaxCount = player.money;
      }

      if (otherSavingsTaxCount == 0 || isNaN(otherSavingsTaxCount)) {
        otherSavingsTaxCount = player.datapoints;
      }

      if (locationTaxCount == 0 || isNaN(locationTaxCount)) {
        locationTaxCount = player.buildings;
      }

      var workerTaxDifference = Math.abs(player.employees - workerTaxCount);
      var savingsTaxDifference = Math.abs(player.money - savingsTaxCount);
      var otherSavingsTaxDifference = Math.abs(player.datapoints - otherSavingsTaxCount);
      var locationTaxDifference = Math.abs(player.buildings - locationTaxCount);

      player.reportingAccuracy.onWorkers = workerTaxDifference;
      player.reportingAccuracy.onSavings = savingsTaxDifference;
      player.reportingAccuracy.onOtherSavings = otherSavingsTaxDifference;
      player.reportingAccuracy.onLocations = locationTaxDifference;

      // let's generate some percentages


      // it's a crime if the player fails to report the amount of workers they have within 20% of the true value.
      if (workerTaxDifference > Math.round(player.employees * generatePercentage(0.2))) {
        player.payrollTaxFraudCounts++;
        payrollTaxFraudCommittedThisYear++;
        console.log('YOU COMMITTED A CRIME');
        console.log(player.payrollTaxFraudCounts);
      }

      // it's a crime if the player fails to report the amount of money they have within 25% of the true value.
      if (savingsTaxDifference > Math.round(player.money * generatePercentage(0.25))) {
        player.accountingFraudCounts++;
        accountingFraudCommittedThisYear++;
        console.log('YOU COMMITTED A CRIME');
        console.log(player.accountingFraudCounts);
      }

      // it's a crime if the player fails to report the amount of datapoints they have within 20% of the true value.
      if (otherSavingsTaxDifference > Math.round(player.datapoints * generatePercentage(0.20))) {
        player.nonDisclosureFraudCounts++;
        nonDisclosureFraudCommittedThisYear++;
        console.log('YOU COMMITTED A CRIME');
        console.log(player.nonDisclosureFraudCounts);
      }

      // it's a crime if the player fails to report the amount of buildings they have within 50% of the true value.
      if (locationTaxDifference > Math.round(player.buildings * generatePercentage(0.50))) {
        player.propertyTaxFraudCounts++;
        propertyTaxFraudCommittedThisYear++;
        console.log('YOU COMMITTED A CRIME');
        console.log(player.propertyTaxFraudCounts);
      }

      // let's calculate a tax rate.

      var workerTaxRate = Math.round(player.employees * 0.0765);
      var savingsTaxRate = Math.round(player.money * 0.10);
      var otherSavingsTaxRate = Math.round(player.datapoints * 0.15);
      var locationTaxRate = Math.round(player.buildings * 0.01);




      resumeTime();

      document.getElementById('world-map').style.filter = "none";
      document.getElementById('user-desk').style.bottom = "-150%";
      document.getElementById('user-desk').style.pointerEvents = "none";
      document.getElementById('sidebar').style.display = "block";


      setTimeout(function () {

        var totalFraudCountsCommittedThisYear = payrollTaxFraudCommittedThisYear + accountingFraudCommittedThisYear + nonDisclosureFraudCommittedThisYear + propertyTaxFraudCommittedThisYear;
        if (totalFraudCountsCommittedThisYear == 0) {
          sendMail('TAX FORM SUBMITTED', `Your tax form has been submitted. Thank you for your cooperation.`);
        } else if (totalFraudCountsCommittedThisYear == 1) {
          sendMail('TAX FORM SUBMITTED', `THIS IS A NOTICE. Some discrepancies were found in your tax form. Please be more careful in the future.`);
        } else if (totalFraudCountsCommittedThisYear == 2) {
          sendMail('TAX FORM SUBMITTED', `THIS IS A WARNING. Some discrepancies were found in your tax form. Please be more careful in the future.`);
        } else if (totalFraudCountsCommittedThisYear == 3) {
          sendMail('TAX FORM SUBMITTED', `YOU ARE BEING FINED. THIS IS A WARNING. Many discrepancies were found in your submitted tax form. You are being fined and are on notice. Please be more careful in the future.`
            `<button onclick = "updateBalance('subtract', 250000);removeMail(this.parentElement)"><i style = "float:none!important;font-size:12px!important;" class="ri-money-dollar-circle-fill"></i> PAY FINE [$250K]</button>`);
        } else {
          sendMail('TAX FORM SUBMITTED', `YOU ARE BEING FINED. THIS IS A WARNING. Many discrepancies were found in your submitted tax form. You are being fined and are on notice. Please insure that this does not happen again.
          <button onclick = "updateBalance('subtract', 500000);removeMail(this.parentElement)"><i style = "float:none!important;font-size:12px!important;" class="ri-money-dollar-circle-fill"></i> PAY FINE [$500K]</button>`);
        }

        updateBalance('subtract', workerTaxRate + savingsTaxRate + otherSavingsTaxRate + locationTaxRate);

        notifyPlayer('TAXES PAID: $' + (workerTaxRate + savingsTaxRate + otherSavingsTaxRate + locationTaxRate));

      }, 5000)



    }

    var notifCounter = 0;

    function sendMail(title, message, customButton) {

      document.getElementById('mail_blurb').style.display = "none";

      if (customButton) {

        document.getElementById('inbox').innerHTML += `
      <div class="mail-message">
              <span>${title}</span>
              <h3>${message}</h3>
              ` + customButton + `
              <button onclick="removeMail(this.parentElement)"><i style = "float:none!important;font-size:12px!important;" class="ri-close-fill"></i> DISMISS</button>
              </div>
      `;

      } else {

        document.getElementById('inbox').innerHTML += `
      <div class="mail-message">
              <span>${title}</span>
              <h3>${message}</h3>
              <button onclick="removeMail(this.parentElement)"><i style = "float:none!important;font-size:12px!important;" class="ri-close-fill"></i> DISMISS</button>
            </div>
      `;
      }

      notifCounter++;
      document.getElementById('mail-icon').style.animation = "pulse-mail 1s infinite";

    }

    function removeMail(message) {
      message.style.pointerEvents = "none";
      message.remove();
      notifCounter--;
      if (notifCounter == 0) {
        document.getElementById('mail-icon').style.animation = "none";
        document.getElementById('mail_blurb').style.display = "block";
      }
    }


    function notifyPlayer(message) {
      UIkit.notification({
        message: message,
        status: 'primary',
        pos: 'bottom-right',
        timeout: 5000
      });
    }

    // create an array to store the distances between all buildings and police stations
    var distances = [];



    function dictatePoliceActions() {
      // get the location of each police station in the policeBuildings array by their #id.
      // get the location of each building in buildingIndex array by their #id.
      // iterate through each building
      for (var i = 0; i < player.buildingsIndex.length; i++) {
        // get the coordinates for the current building in pixels
        var building_x = document.getElementById(player.buildingsIndex[i]).getBoundingClientRect().x;
        var building_y = document.getElementById(player.buildingsIndex[i]).getBoundingClientRect().y;

        // iterate through each police station
        for (var j = 0; j < policeBuildings.length; j++) {
          // get the coordinates for the current police station in pixels
          var police_x = document.getElementById(policeBuildings[j]).getBoundingClientRect().x;
          var police_y = document.getElementById(policeBuildings[j]).getBoundingClientRect().y;

          // calculate the distance between the police station and the building
          var distance = Math.sqrt(Math.pow(police_x - building_x, 2) + Math.pow(police_y - building_y, 2));

          // push the distance to the distances array
          distances.push(distance);
        }
      }

      // log the distances array to the console
      console.log(distances);

      // Use your judgment to determine if the player has decided to avoid police presence or be near them based on the distances array.
      // You can add your logic here to analyze the distances and make a decision.
      // For example, you can check if the minimum distance is below a certain threshold to determine if the player is near police presence.
      // Alternatively, you can check if all distances are above a certain threshold to determine if the player is avoiding police presence.
      // Modify the code below to implement your logic.

      var minDistance = Math.min(...distances);
      var maxDistance = Math.max(...distances);

      if (minDistance < 1000) {
        console.log("Player is near police presence");
        police.awareness += 1;
      } else if (maxDistance > 5000) {
        console.log("Player is avoiding police presence");
        police.awareness -= 0.5;
      } else {
        console.log("Player is neither near nor avoiding police presence");
        police.awareness += 0.25;
      }

      // set the outline color of the police stations to the number of pixels their awareness is, times 5.

      for (var i = 0; i < policeBuildings.length; i++) {
        document.getElementById(policeBuildings[i]).style.boxShadow = `0 0 0 ${police.awareness * 10}px rgba(255, 0, 0, 0)`;

      }

      // calculate how much money the user is making in one day. 
      // basically a good rule of thumb is that the police awareness should increase exponentially (meaning a log function) the more money the user makes.
      // player.income is daily income, you jackass

      if (player.income >= 1000000) {
        // Increase exponentially for income over a million
        police.awareness += Math.log(player.income) / Math.log(10);
      } else if (player.income >= 250000 && player.income < 500000) {
        // Increase gradually for income between 250K and 500K
        police.awareness += 0.25;
      } else if (player.income < 50000) {
        // Decrease gradually for income less than 50K, but not below zero
        police.awareness = Math.max(police.awareness - 0.05, 0);
      }





      // Calculate the average distance
      var totalDistance = distances.reduce((acc, curr) => acc + curr, 0);
      var averageDistance = totalDistance / distances.length;

      // Calculate the standard deviation of distances
      var squaredDistances = distances.map(distance => Math.pow(distance - averageDistance, 2));
      var variance = squaredDistances.reduce((acc, curr) => acc + curr, 0) / distances.length;
      var standardDeviation = Math.sqrt(variance);


      // DIFFERENCE BETWEEN AWARENESS AND AGGRESSION:
      // the higher awareness is, the more likely the player is to encounter the police.
      // the higher aggression is, the harder the police will be to defeat in battle.

      // check the number of datapoints the player has. since canonically this is illegal activity, 
      // the more datapoints the player is sitting on, the more likely they are to be caught.
      // define a threshold for the number of datapoints that the player has to be sitting on before they are more likely to be caught.

      if (player.datapoints > 1000000) {
        police.awareness += 1;
      } else if (player.datapoints < 1000) {
        police.awareness -= 0.5;
      } else {
        police.awareness += 0.005;
      }

      // check how accurate the player has been in reporting their taxes.
      // if the player has been consistently inaccurate, they are more likely to be caught.
      // define a threshold for the number of fraud counts that the player has to be sitting on before they are more likely to be caught.

      if (player.payrollTaxFraudCounts > 5 || player.accountingFraudCounts > 5 || player.nonDisclosureFraudCounts > 5 || player.propertyTaxFraudCounts > 5) {
        police.awareness += 1;
      } else if (player.payrollTaxFraudCounts < 1 || player.accountingFraudCounts < 1 || player.nonDisclosureFraudCounts < 1 || player.propertyTaxFraudCounts < 1) {
        police.awareness -= 0.5;
      } else {
        police.awareness += 0.005;
      }

      if (police.awareness < 0) {
        police.awareness = 0;
        police.awareness += 0.01;
      }

      if (police.aggression < 0) {
        police.aggression = 0;
        police.aggression += 0.01;
      }

      if (police.awareness > 150) {
        police.awareness = 50;
      }

      if (police.aggression > 150) {
        police.aggression = 50;
      }


      if (police.awareness > 50 && police.aggression > 50) {
        var arrestStatus = shouldArrestPlayer(player);

        if (arrestStatus) {
          alert('YOU HAVE BEEN ARRESTED');
        } else {
          console.log("Player is not being arrested");
        }

      }


      console.log("Police awareness: " + police.awareness);
      console.log("Police aggression: " + police.aggression);



    }

    function shouldArrestPlayer(player) {
      // Initialize a score to determine the likelihood of arrest
      let arrestScore = 0;

      // Increase the score based on the number of fraud counts
      arrestScore += player.payrollTaxFraudCounts;
      arrestScore += player.accountingFraudCounts;
      arrestScore += player.nonDisclosureFraudCounts;
      arrestScore += player.propertyTaxFraudCounts;
      arrestScore += player.dataTraffickingCounts / 10;


      if (police.awareness < 100 || police.aggression < 100) {
        return false;
      } else {

        if (arrestScore > 50) {

          var FinalArrestScore = 0;

          if (player.accountingFraudCommittedThisYear > 0 && player.accountingFraudCounts > 1) {
            FinalArrestScore += 1;
          } else {
            FinalArrestScore -= 0.5;
          }

          if (player.payrollTaxFraudCommittedThisYear > 0 && player.payrollTaxFraudCounts > 5) {
            FinalArrestScore += 1;
          } else {
            FinalArrestScore -= 0.5;
          }

          if (player.nonDisclosureFraudCommittedThisYear > 0 && player.nonDisclosureFraudCounts > 2) {
            FinalArrestScore += 1;
          } else {
            FinalArrestScore -= 0.5;
          }

          if (player.propertyTaxFraudCommittedThisYear > 0 && player.propertyTaxFraudCounts > 3) {
            FinalArrestScore += 1;
          } else {
            FinalArrestScore -= 0.5;
          }

          if (player.dataTraffickingCounts > 100) {
            FinalArrestScore += 1;
          } else {
            FinalArrestScore -= 0.5;
          }

          if (FinalArrestScore > 3) {
            return true;
          } else {
            return false;
          }

        } else {
        }

      }
    }

    function beginBattleEvent() {
      killTime();
      document.getElementById('battleFrame').style.top = "0";
      document.getElementById('battleFrame').style.filter = "none";
      document.getElementById('battleFrame').style.transform = "scale(1)";
      document.getElementById('battleFrame').style.opacity = "100%";
      document.getElementById('battleFrame').style.pointerEvents = "auto";
      document.getElementById('weather_filter').style.display = "none";
      document.getElementById('fog_filter').style.display = "none";
      document.getElementById('vignette').style.display = "none";
      document.getElementById('world-map').style.filter = "blur(10px)";
        document.getElementById('topbar').style.display = "none";
        document.getElementById('sidebar').style.display = "none";
        document.getElementById('crt-lines').style.opacity = "10%";
        document.getElementById('crt-lines').style.zIndex = "10000";
        document.getElementById('fps').style.display = "none";

        setTimeout(function () {
          document.getElementById('enemy_battle_sprite').style.opacity = "100%";
          policeApproachingAnimation();
         
          document.getElementById('world-map').style.opacity = "50%";
          document.body.style.backgroundImage = 'url("sprites/street.gif")';

        }, 500);

        document.getElementById('battleTextDiv').style.opacity = "100%";
        document.getElementById('battleTextDiv').style.pointerEvents = "auto";

      }


      function endBattleEvent() {
  // Assuming the original styles are the opposite of what's set in beginBattleEvent
  document.getElementById('battleFrame').style.top = "";
  document.getElementById('battleFrame').style.opacity = "0";
  document.getElementById('battleFrame').style.pointerEvents = "none";
  document.getElementById('weather_filter').style.display = "block";
  document.getElementById('fog_filter').style.display = "block";
  document.getElementById('vignette').style.display = "block";
  document.getElementById('world-map').style.filter = "none";
  document.getElementById('topbar').style.display = "block";
  document.getElementById('sidebar').style.display = "block";
  document.getElementById('crt-lines').style.opacity = "0%";
  document.getElementById('fps').style.display = "block";

  document.getElementById('enemy_battle_sprite').style.opacity = "0";
  document.getElementById('enemy_battle_sprite').style.backgroundImage = "url('sprites/officer_disappointed.png')";
  document.getElementById('enemy_battle_sprite').style.transform = "translate(-50%,-50%) scale(0.5)";
  document.getElementById('world-map').style.opacity = "100%";
  
  document.body.style.backgroundImage = '';

  document.getElementById('battleTextDiv').style.opacity = "0";
  document.getElementById('battleTextDiv').style.pointerEvents = "none";
}


    function policeApproachingAnimation() {
      document.getElementById('enemy_battle_sprite').style.backgroundImage = "url('sprites/officer_approaches.png')";
      document.getElementById('enemy_battle_sprite').style.transform = "translate(-50%,-50%) scale(1.1)";
      document.getElementById('enemy_battle_sprite').style.filter = "blur(0px) drop-shadow(15px 15px 0px #1a1a1a)";
      setTimeout(function () {
        document.getElementById('enemy_battle_sprite').style.backgroundImage = "url('sprites/officer_approaches_l.png')";

        setTimeout(function () {
          document.getElementById('enemy_battle_sprite').style.backgroundImage = "url('sprites/officer_approaches.png')";
        }, 250);



      }, 250);

    }


    VANTA.FOG({
      el: "#fog_filter",
      mouseControls: true,
      touchControls: true,
      gyroControls: false,
      minHeight: 200.00,
      minWidth: 200.00,
      highlightColor: "#ffffffa0",
      midtoneColor: "#000000a0",
      lowlightColor: "#000000a0",
      baseColor: "#000000",
      blurFactor: 0.30,
      speed: 0.00,
      zoom: 2.75
    })


    function decideWeather() {

      var random = Math.random();

      if (random > 0.5) {

        //clear skies.
        document.getElementById('fog_filter').style.opacity = "15%";
        document.getElementById('weather_filter').style.opacity = "0%";
        console.log('clear skies');
        return 'clear';

      } else {

        //rain/fog.
        document.getElementById('fog_filter').style.opacity = "25%";
        document.getElementById('weather_filter').style.opacity = "100%";
        console.log('foggy');
        return 'foggy';


      }

    }


    // let's write a function that allows the player to walk around the map. the code should:
    // 1. generate a player character
    // 2. allow the player to move the character around the map via the arrow keys
    // 3. make sure that the player can't walk through buildings
    // 4. make sure that the player can't walk off the map
    // 5. make sure that the player can't walk through police stations
    // 6. make sure that the player can't walk on water

    function movePlayer() {
      panZoomModeEnabled = false;

    }



    // keyup event listener.
    // when the key is up, get the backgroundimage of player.
    // swap it out for a still image based on the direction the player is facing.

    document.addEventListener('keyup', function (event) {
      if (event.key === 'ArrowUp') {
        document.getElementById('player').style.backgroundImage = "url('sprites/character/cat/black/back/back2.png')";
      } else if (event.key === 'ArrowDown') {
        document.getElementById('player').style.backgroundImage = "url('sprites/character/cat/black/front/front2.png')";
      } else if (event.key === 'ArrowLeft') {
        document.getElementById('player').style.backgroundImage = "url('sprites/character/cat/black/right/right2.png')";
      } else if (event.key === 'ArrowRight') {
        document.getElementById('player').style.backgroundImage = "url('sprites/character/cat/black/left/left2.png')";
      }
    });



    window.requestAnimFrame = (function () {
      return window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.ieRequestAnimationFrame ||
        function (callback) {
          window.setTimeout(callback, 1000 / 60);
        };
    })();

    let fpsElement = document.getElementById("fps");

    let frameCount = 0;
    let lastUpdateTime = Date.now();
    let fps = 0;
    let lastFps = null;

    let render = function () {
      // count the number of frames
      frameCount++;

      // get the current time
      let now = Date.now();

      // calculate the time difference
      let diff = now - lastUpdateTime;

      // if the time difference is greater than 1 second
      if (diff > 1000) {
        // calculate the fps
        fps = frameCount / (diff / 1000);

        // reset the frame count
        frameCount = 0;

        // update the last update time
        lastUpdateTime = now;

        // update the fps element only if the fps value has changed
        if (fps.toFixed(1) !== lastFps) {
          fpsElement.innerText = fps.toFixed(0) + " FPS";
          lastFps = fps.toFixed(0);
        }
      }

      requestAnimFrame(render);
    };


  </script>
</body>

</html>