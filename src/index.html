<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>Scam Tycoon</title>
  <!-- UIkit CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.17.11/dist/css/uikit.min.css" />

  <!-- UIkit JS -->
  <script src="https://cdn.jsdelivr.net/npm/uikit@3.17.11/dist/js/uikit.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/uikit@3.17.11/dist/js/uikit-icons.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.1.0/remixicon.min.css"
    integrity="sha512-i5VzKip7owqOGjb0YTF8MR2J9yBVO3FLHeazKzLp354XYTmKcqEU3UeFYUw82R8tV6JqxeATOfstCfpfPhbyEA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="crt.css">
  <link rel="stylesheet" href="vig.css">
  <script src='https://unpkg.com/panzoom@9.4.0/dist/panzoom.min.js'></script>
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <script src="https://unpkg.com/tippy.js@6"></script>
  <style>
    /*add my custom fonts*/

    @font-face {
      font-family: "gamer";
      src: url("sprites/gamer.ttf");
    }

    @font-face {
      font-family: "beeg";
      src: url("sprites/8bitfont.ttf");
    }

    @font-face {
      font-family: "pst";
      src: url("sprites/pst.ttf");
    }

    body,
    html {
      height: 100%;
      margin: 0;
      padding: 0px;
      width: 100%;
      overflow: hidden;
      font-family: 'gamer';
      filter: sepia(1) hue-rotate(45deg);
      user-select: none !important;
      background-color:black;
    }


    .grid-container {
      display: grid;
      grid-template-columns: repeat(48, 1fr);
      grid-template-rows: repeat(48, 1fr);
      background-color: #ccc;
      width: 100%;
      height: 100%;
      position: relative;
      margin: 0px;
    }

    .grid-item {
      background-color: #e9e9e9;
      outline: 1.5px solid #c3c3c320;
      box-sizing: border-box;
      background-image: url('sprites/city_block.png');
      background-size: 100%;
      background-repeat: no-repeat;
      image-rendering: pixelated;

    }


    #navbar {
      position: fixed;
      bottom: 0;
      z-index: 1000;
      background-color: black;
      box-sizing: border-box;
      width: 98%;
      margin: 1%;
      border-radius: 7.5px;
      font-weight: 900;
      font-size: 20px;
      color: white;
      opacity: 50%;
      vertical-align: middle;
      display: flex;
      padding: 10px;
    }

    #navbar:hover {
      opacity: 100%;
    }

    #navbar button {
      color: white;
      border: none;
      font-size: 20px;
      background-color: transparent;
      border-radius: 100vmin;
      aspect-ratio: 1/1;
      cursor: pointer;
    }

    #topbar {
      position: absolute;
      top: -20%;
      left: 0;
      z-index: 10000;
      background-color: black;
      width: 100%;
      font-weight: 900;
      font-size: 20px;
      vertical-align: middle;
      padding: 0px;
      margin: 0px;
      text-align: right;
      box-sizing: border-box;
      transition: all 1s;
      transition-timing-function:cubic-bezier(0.8,0,0,1);
    }

    #topbar p:nth-child(even) {
      background-color: transparent;
    }

    #topbar p:nth-child(odd) {
      background-color: #1a1a1a;
    }

    #topbar p {
      font-weight: 100;
      font-size: 20px;
      padding: 0px;
      margin: 0px;
      vertical-align: middle;
      display: inline-block;
      padding-left: 10px;
      padding-right: 10px;
      white-space: normal;
      border: 5px solid transparent;
    }

    #topbar p i {
      font-size: 14px;
    }

    .tippy-box {
      background-color: #000;
      font-family: 'pst';
      font-size: 9px !important;
      border-radius: 0px;
      box-shadow: 2.5px 2.5px 0px #008000;
    }

    .tippy-box hr {
      padding: 1.5px;
      margin: 0px;
      box-sizing: border-box;
      opacity: 50%;
    }

    .tippy-box h3 {
      color: green;
      font-family: 'pst';
      font-size: 10px;
      border: 1.5px solid;
      padding: 5px;
      text-align: center;
      display: block;
      margin-top: 7.5px;
      margin-bottom: 7.5px;
      cursor: pointer;
    }

    .tippy-box h3:hover {
      box-shadow: 1.5px 1.5px 0px green;
      transform: scale(1.05);
    }

    .tippy-arrow {
      background-color: #000 !important;
      color: #000 !important;
    }

    [data-tippy-root] {
      z-index: 1000000000000000 !important;
    }

    #world-map {
      filter:blur(50px);
      transition: filter 1s;
      transition-timing-function:cubic-bezier(0.8,0,0,1);
    }

    #topbar .uk-dropdown {
    background-color: black;
    margin: 0px;
    padding: 5px;
    box-shadow: 5px 5px 0px green;
    text-align: left;
    box-sizing: border-box;
    padding-left: 10px;
    padding-right: 10px;
    }

    #topbar .uk-dropdown hr {
      padding: 1.5px;
      margin: 0px;
      box-sizing: border-box;
      opacity: 50%;
    }

    .building_index_listing_item {

      display: block;
    box-sizing: border-box;
    padding: 5px;
    padding-top: 2.5px;
    padding-bottom: 2.5px;
    border: 5px solid black;
    border-left: none;
    border-right: 0px;
    font-size: 22px;

    }

    .building_index_listing_item:nth-child(even) {
      background-color: transparent;
    }

    .building_index_listing_item:nth-child(odd) {
      background-color: #1a1a1a;
    }

  </style>
  <link rel="stylesheet" href="zones.css">
  <link rel="stylesheet" href="buildings.css">
</head>

<body>
  <div id="topbar">

    <div style="float:left;display:none">
      <select id="building-select">
        <option value="admin-buildings">Call Center</option>
        <option value="office-building">Office Building</option>
        <!-- Add more options as needed -->
      </select>
      <button id="toggle-building-mode"><i class="ri-hammer-fill"></i></button>
    </div>
    <div style="float:right;display:flex;">
      <p id="player-money"> <i class="ri-money-dollar-circle-fill"></i> 0</p>
      <p id="player-level"><i class="ri-shield-fill"></i> 00</p>
      <p id="employee-count"><i class="ri-user-5-fill"></i> 0</p>
      <p id="building-count"><i class="ri-hotel-fill"></i> 0</p>
      <div id = "building-index-list" uk-dropdown>
        <ul class="uk-nav uk-dropdown-nav">YOUR PROPERTIES
          <hr>

        </ul>
    </div>
    </div>

  </div>
  <div id="navbar">





  </div>
  <div id="world-map" class="grid-container"></div>

  <script src="functionLibrary.js"></script>
  <script src="layoutGen.js"></script>
  <script src="buildingMode.js"></script>
  <script src="panZoomConfig.js"></script>
  <script src="buildingAppearance.js"></script>
  <script src="buildingGen.js"></script>
  <script src="tippyConfig.js"></script>
  <script>
    var player = {
      money: 0,
      income: 0,
      expenses: 0,
      level: 0,
      employees: 0,
      buildings: 0,
      buildingsIndex: [],
    };

    // update the player's balance based on input
    function updateBalance(operation, amount) {
      if (operation === "add") {
        player.money += amount;
      } else if (operation === "subtract") {
        player.money -= amount;
      } else {
        console.log("error");
      }
      document.getElementById("player-money").innerHTML = `<i class="ri-money-dollar-circle-fill"></i> ${player.money.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
    }

    function updateLevel() {
      player.level += 1;
      document.getElementById("player-level").innerHTML = `<i class="ri-shield-fill"></i> ${player.level}`;
    }

    function updateEmployeeCount(operation, amount) {
      if (operation === "add") {
        player.employees += amount;
      } else if (operation === "subtract") {
        player.employees -= amount;
      } else {
        console.log("error");
      }
      document.getElementById("employee-count").innerHTML = `<i class="ri-user-5-fill"></i> ${player.employees}`;
    }

    function updateBuildingCount(operation, amount, buildingID) {
  if (operation === "add") {
    player.buildings += amount;
    player.buildingsIndex.push(buildingID); // Add buildingID to the index
    // get the background image's url from the buildingID square
    var building = document.querySelector(`[data-name="${buildingID}"]`);
    console.log(building.style.backgroundImage);
    document.getElementById("building-index-list").innerHTML += `
    <div class = "building_index_listing_item" id = "${buildingID}_index_listing">
    <img src = "${building.style.backgroundImage.replace('url("','')}" style = "width:20px;height:20px;vertical-align:middle">
    <a href="#"><i>#</i> ${buildingID.replace('gridsquare_', '')}</a><br>
    </div>
    `;
  } else if (operation === "subtract") {
    player.buildings -= amount;
    const index = player.buildingsIndex.indexOf(buildingID);
    if (index > -1) {
      player.buildingsIndex.splice(index, 1); // Remove buildingID from the index
      // remove the building from the building index list
      document.getElementById(buildingID+"_index_listing").remove();
    }
  } else {
    console.log("error");
  }
  document.getElementById("building-count").innerHTML = `<i class="ri-hotel-fill"></i> ${player.buildings}`;
}

  function addExpense(amount) {
    player.expenses += amount;
  }

  function removeExpense(amount) {
    player.expenses -= amount;
  }


    function buyBuilding(buildingID, buildingBuyValue) {
      // check if player has enough money to buy building, and if they don't already own it
      // if they do, subtract the cost from their balance and add the building to their index
      // then, update the building's forSale value to false
      if (player.money >= buildingBuyValue && !player.buildingsIndex.includes(buildingID)) {
        updateBalance("subtract", buildingBuyValue);
        updateBuildingCount("add", 1, buildingID);
        // get the element with the data-building-id of the buildingID passed
        console.log(buildingID);
        var building = document.querySelector(`[data-name="${buildingID}"]`);
        // get the data-resale-value of this building
        var buildingResaleValue = building.dataset.resaleValue;
        console.log("building rsale value: "+buildingResaleValue);
        document.getElementById(buildingID+"_player_options").innerHTML = `
        <h3 onclick = "sellBuilding('${buildingID}', ${buildingResaleValue})" style = "display:block;color:red;vertical-align:middle"><i style = "vertical-align:top" class="ri-money-dollar-circle-fill"></i> SELL</h3>
        `;
        building.style.animation = "pulse 1s infinite";
      } else {
        alert("You don't have enough money to buy this building!");
      }
    }

    function rentBuilding(buildingID, buildingRentValue){
      // check if player has enough money to rent building, and if they don't already own it
      // if they do, subtract the cost from their balance and add the building to their index
      // then, update the building's forRent AND forSale value to false
      if (player.money >= buildingRentValue && !player.buildingsIndex.includes(buildingID)) {
        updateBalance("subtract", buildingRentValue);
        updateBuildingCount("add", 1, buildingID);
        addExpense(buildingRentValue);
        // get the element with the data-building-id of the buildingID passed
        console.log(buildingID);
        var building = document.querySelector(`[data-name="${buildingID}"]`);
        // get the data-resale-value of this building
        var buildingRentValue = building.dataset.rentValue;
        console.log("building rsale value: "+buildingRentValue);
        document.getElementById(buildingID+"_player_options").innerHTML = `
        <h3 onclick = "exitBuilding('${buildingID}', ${buildingRentValue})" style = "display:block;color:red;vertical-align:middle"><i style = "vertical-align:top" class="ri-money-dollar-circle-fill"></i> CANCEL RENT</h3>
        `;
        building.style.animation = "pulse 1s infinite";
      } else {
        alert("You're screwed actually, you don't have enough money to leave :pensive:");
      }
    }

    function sellBuilding(buildingID, buildingSellValue) {
      // check if player owns the building
      // if they do, add the sell value to their balance and remove the building from their index
      // then, update the building's forSale value to true
      if (player.buildingsIndex.includes(buildingID)) {
        updateBalance("add", buildingSellValue);
        updateBuildingCount("subtract", 1, buildingID);
        // get the element with the data-building-id of the buildingID passed
        var building = document.querySelector(`[data-name="${buildingID}"]`);
// get the data-buy-value of this building
var buildingBuyValue = building.dataset.buyValue;
var buildingRentValue = building.dataset.rentValue;
        console.log("building buy value: "+buildingBuyValue);
        console.log("building rent value: "+buildingRentValue);
        // detect if this is a restaurant or not, from this building's classList
        var isResturant = Array.from(building.classList).some(cls => cls.includes('restaurant'));
        console.log(building.classList);
        if (isResturant){
          document.getElementById(buildingID+"_player_options").innerHTML = `
        <h3 onclick = "buyBuilding('${buildingID}', ${buildingBuyValue})" style = "display:block;color:red;vertical-align:middle"><i style = "vertical-align:top" class="ri-money-dollar-circle-fill"></i> FOR SALE</h3>
        `;
        } else {
          document.getElementById(buildingID+"_player_options").innerHTML = `
        <h3 onclick = "rentBuilding('${buildingID}', ${buildingRentValue})" style = "display:block;color:red;vertical-align:middle"><i style = "vertical-align:top" class="ri-money-dollar-circle-line"></i> FOR RENT</h3>
        <h3 onclick = "buyBuilding('${buildingID}', ${buildingBuyValue})" style = "display:block;color:red;vertical-align:middle"><i style = "vertical-align:top" class="ri-money-dollar-circle-fill"></i> FOR SALE</h3>
        `;
        }
        building.style.animation = "none";
      } else {
        alert("You already sold this building!");
      }
    }

    function exitBuilding(buildingID, buildingRentValue) {
      // check if player owns the building
      // if they do, add the sell value to their balance and remove the building from their index
      // then, update the building's forSale value to true
      if (player.buildingsIndex.includes(buildingID)) {
        updateBuildingCount("subtract", 1, buildingID);
        removeExpense(buildingRentValue);
        // get the element with the data-building-id of the buildingID passed
        var building = document.querySelector(`[data-name="${buildingID}"]`);
// get the data-buy-value of this building
var buildingBuyValue = building.dataset.buyValue;
var buildingRentValue = building.dataset.rentValue;
        console.log("building buy value: "+buildingBuyValue);
        console.log("building rent value: "+buildingRentValue);
        // detect if this is a restaurant or not, from this building's classList
        var isResturant = Array.from(building.classList).some(cls => cls.includes('restaurant'));
        console.log(building.classList);
        if (isResturant){
          document.getElementById(buildingID+"_player_options").innerHTML = `
        <h3 onclick = "buyBuilding('${buildingID}', ${buildingBuyValue})" style = "display:block;color:red;vertical-align:middle"><i style = "vertical-align:top" class="ri-money-dollar-circle-fill"></i> FOR SALE</h3>
        `;
        } else {
          document.getElementById(buildingID+"_player_options").innerHTML = `
        <h3 onclick = "rentBuilding('${buildingID}', ${buildingRentValue})" style = "display:block;color:red;vertical-align:middle"><i style = "vertical-align:top" class="ri-money-dollar-circle-line"></i> FOR RENT</h3>
        <h3 onclick = "buyBuilding('${buildingID}', ${buildingBuyValue})" style = "display:block;color:red;vertical-align:middle"><i style = "vertical-align:top" class="ri-money-dollar-circle-fill"></i> FOR SALE</h3>
        `;
        }
        building.style.animation = "none";
      } else {
        alert("You already sold this building!");
      }
    }

    function initToolbars(){
    document.getElementById("topbar").style.top = "0px"; 
    document.getElementById("world-map").style.filter = "blur(0px)"; 
    }

    function initIntervals(){
      setInterval(monthlyInterval);
    }

    window.onload = function () {
      initBuildingAppearance();
      updateBalance("add", 10000000);

      initToolbars();
      initIntervals();
    };


    // 1 hour equals 1 year in the game.
    // 5 minutes = one month
    // all time values are in milliseconds.

    var monthlyMillisecondValue = 300000;
    var testMonthlyMillisecondValue = 10000;
    var yearlyMillisecondValue = 3600000;
    var testYearlyMillisecondValue = 10000;

    var monthlyInterval = setInterval(function () {
    
    updateBalance("add", player.income);  
    updateBalance("subtract", player.expenses);

    }, testMonthlyMillisecondValue);


    // questions - how should we handle negative balances? here are the choices i'm thinking:
    // 1. realistic. the player should be able go into debt. they're not denied their income,
    // but obviously they can't buy anything, as they can't afford it. they should figure out 
    // ways to increase it by doing more scams.
    // 2. players aren't allowed to have less than 0 dollars.
    // if they can't pay rent on a building for more than 5 intervals, they lose the building.

  </script>
</body>

</html>